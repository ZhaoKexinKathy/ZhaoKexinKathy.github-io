# 使用WSL进行Linux开发Set up总结

准备：windows： win10 2014以上版本

# 一 安装WSL

在应用中找到cmd，以管理员身份运行，输入命令

```bash
wsl --install
```

默认的版本是最常用的Ubantu，如果想要其他版本输入

```bash
wsl --install -d <Distribution Name>
```

现在WSL已经装好了，我们可以用start menu打开ubantu

开始显示Installing之后会提示输入用户名和密码，Ubantu要求的用户名：

小写字母开头

只能包含小写字母，下划线_和连字符-

可以用美元符号$结尾

我在这里遇到的问题是没有网络连接，可以用ping google.com（任意域名）试一下能不能联通，如果有网络的话返回得很快，ctrl+C 退出直接进行步骤二，如果等几秒没有回应需要更改一些设置

在Ubantu中输入命令

```cpp
sudo nano /etc/resolv.conf
```

可以看到一个文件

```cpp
# This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/resolv.conf
# [network]
# generateResolvConf = false
nameserver xxx.xx.xx
```

把nameserver改成8.8.8.8

nano是一个文件编辑器，修改之后ctrl+O保存，这里会提示修改文件名字，不用改得话直接enter就可以

以管理员身份运行windows命令行工具，输入wsl —shutdown，关闭wsl再重新打开Ubantu，再次用ping测试一下网络连接

# 二 配置基本开发工具VScode和git

windows上如果已经安装了vscode，在extension中安装[Remote Development extension pack](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack)，就可以在Ubantu中用code <path>，打开VScode

git是针对不同的文件系统而言，所以即使window上有git也需要在WSL上重新安装。其他工具都可以按Linux上安装的步骤来

```cpp
sudo apt-get update
sudo apt-get install git
sudo apt-get install gdb
sudo apt-get install build-essential
sudo apt-get install python
```

如果有错误，按提示操作

sudo apt --fix-broken install

# 推荐：迁移WSL到指定位置

通过官方的工具安装WSL会默认装到系统盘上，这里介绍方法可以迁移WSL到其他位置

推荐使用工具LxRunOffline，下载地址https://github.com/DDoSolitary/LxRunOffline，选择Development builds下载最新版本解压即可

管理员模式打开cmd，cd到LxRunOffLine.exe所在的目录

```bash
>LxRunOffLine
 # windows下运行exe，可以看到支持的一些操作
Supported actions are:
    l, list            List all installed distributions.
    gd, get-default    Get the default distribution, which is used by bash.exe.
    sd, set-default    Set the default distribution, which is used by bash.exe.
    i, install         Install a new distribution.
    ui, uninstall      Uninstall a distribution.
    rg, register       Register an existing installation directory.
    ur, unregister     Unregister a distribution but not delete the installation directory.
    m, move            Move a distribution to a new directory.
    d, duplicate       Duplicate an existing distribution in a new directory.
    e, export          Export a distribution's filesystem to a .tar.gz file, which can be imported by the "install" command.
    r, run             Run a command in a distribution.
    di, get-dir        Get the installation directory of a distribution.
    gv, get-version    Get the filesystem version of a distribution.
    ge, get-env        Get the default environment variables of a distribution.
    se, set-env        Set the default environment variables of a distribution.
    ae, add-env        Add to the default environment variables of a distribution.
    re, remove-env     Remove from the default environment variables of a distribution.
    gu, get-uid        Get the UID of the default user of a distribution.
    su, set-uid        Set the UID of the default user of a distribution.
    gk, get-kernelcmd  Get the default kernel command line of a distribution.
    sk, set-kernelcmd  Set the default kernel command line of a distribution.
    gf, get-flags      Get some flags of a distribution. See https://docs.microsoft.com/en-us/previous-versions/windows/desktop/api/wslapi/ne-wslapi-wsl_distribution_flags for details.
    sf, set-flags      Set some flags of a distribution. See https://docs.microsoft.com/en-us/previous-versions/windows/desktop/api/wslapi/ne-wslapi-wsl_distribution_flags for details.
    s, shortcut        Create a shortcut to launch a distribution.
    ec, export-config  Export configuration of a distribution to an XML file.
    ic, import-config  Import configuration of a distribution from an XML file.
    sm, summary        Get general information of a distribution.
    version            Get version information about this LxRunOffline.exe.
>LxRunOffLine list
Ubuntu
>LxRunOffline move -n Ubuntu -d E:\wsl
#过一段时间运行完成后， 可以用以下命令查看新的位置，表示迁移成功
>LxRunOffline get-dir -n Ubuntu
```

过程中遇到一个问题，

```bash
>LxRunOffLine list
[ERROR] Couldn't get the value "DistributionName" of the registry key "Software\Microsoft\Windows\CurrentVersion\Lxss\AppxInstallerCache".
Reason: 系统找不到指定的文件。
```

在这个贴子[https://githubhot.com/repo/DDoSolitary/LxRunOffline/issues/171](https://githubhot.com/repo/DDoSolitary/LxRunOffline/issues/171)中找到了解决方法

打开注册表编辑器，按提示的路径Software\Microsoft\Windows\CurrentVersion\Lxss点进去，把AppxInstallerCache文件夹删掉就可以啦

参考资料：

[https://docs.microsoft.com/en-gb/windows/wsl/install](https://docs.microsoft.com/en-gb/windows/wsl/install)

[https://docs.microsoft.com/en-gb/windows/wsl/setup/environment#set-up-your-linux-username-and-password](https://docs.microsoft.com/en-gb/windows/wsl/setup/environment#set-up-your-linux-username-and-password)

[https://docs.microsoft.com/en-gb/windows/wsl/tutorials/wsl-vscode](https://docs.microsoft.com/en-gb/windows/wsl/tutorials/wsl-vscode)